$(function(){var e=document.title.replace(/^\([0-9]+\) /,"");var t={NOTED:"이 <strong>#{{article.id}}</strong> 에 댓글을 남겼습니다.",NOTED_AFTER:"도 게시물 <strong>#{{article.id}}</strong> 에 댓글을 남겼습니다.",ASSENTED_ARTICLE:"이 회원님의 게시물 <strong>#{{article.id}}</strong> 를 추천 하였습니다.",ASSENTED_NOTE:"이 게시물 <strong>#{{article.id}}</strong> 에 작성하신 회원님의 댓글을 추천 하였습니다."};$("#user-notification").on("shown.bs.popover",function(){$("#notification-popover").spin("small");$.ajax({url:contextPath+"/notification.json",dataType:"json",success:function(e){var n="";r();$(e.notifications).each(function(r,i){var s="",o,u=Mustache.render(t[i.type],i);s+=i.sender.nickname+"님";o=' <span class="timeago pull-right" title="'+i.lastUpdated+'">'+i.lastUpdated+"</span>";var a=new Date(i.lastUpdated)<new Date(e.lastRead);n+='<div class="notification-link clearfix '+(a?"notification-accepted":"")+'" data-article="'+i.article.id+'" data-content="'+i.content.id+'">'+s+u+o+"</div>"});$("#notification-popover").html(n);$("#notification-popover .timeago").timeago()}})});$("#user-func").popover({container:"body",title:"설정",placement:whereToPlacePopover,template:$("#setting-template").html(),html:true});$("#user-notification").popover({container:"body",title:"알림",placement:whereToPlacePopover,template:$("#notification-template").html(),html:true});$(document).delegate("#notification-popover .notification-link","click",function(e){var t=$(this).data();location.href=contextPath+"/article/"+t.article+"?note="+t.content});var n=setInterval(function(){$.ajax({url:contextPath+"/notification/count.json",dataType:"json",success:function(e){r(e.count)},error:function(){clearInterval(n)}})},1e3*60*10);var r=function(t){if(t){$("#user-notification-count").html(t).show();$("#user-notification-icon").hide();document.title="("+t+") "+e}else{$("#user-notification-count").html(0).hide();$("#user-notification-icon").show();document.title=e}}})