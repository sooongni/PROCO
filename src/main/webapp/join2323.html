<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Join</title>
<link rel="stylesheet"
	href="./font-awesome-4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="css/join.css">
</head>

<style>


</style>
<body>

	<div class="form">
		<div class="header">
			<h1>회원가입</h1>
			<div class="sign-in-container">
				<input type="checkbox" value=1 class="memberType"
					onclick="doOpenCheck(this)">&nbsp;일반가입
			</div>
			<div class="sign-in-container2">
				<input type="checkbox" value=2 class="memberType"
					onclick="doOpenCheck(this)">&nbsp;사업자가입
			</div>
		</div>
		<div class="sign-in-form">
			<h2>&nbsp;</h2>
			<h3>이메일</h3>
			<input id="email" type="email"></input>
			<h3>닉네임</h3>
			<input id="alias" type="alias"></input>
			<h3>패스워드</h3>
			<input id="pwd" type="password"></input><br>
		</div>

		<div class="sign-in-form2">
			<h2>&nbsp;</h2>
			<h3>업체명</h3>
			<input class='brname' type="text" id="brname"><span><button
				    class="btn2" id="brnameSearch">조회</button></span><br>
			<h3>사업자 인증번호 [11자리]</h3>
			<input id="businessNumber" type="text" maxlength="11"><span><button
					class="btn2">조회</button></span><br>
			<h3>대표자 전화번호</h3>
			<input id="ceotel" type="text"><span><button
					class="btn2">인증</button></span><br>
		</div>

		<a class='agree'>회원 가입 또는 계속하기를 클릭하면 프로코의 서비스 약관,<br> 결제 서비스
			약관, 개인정보 보호정책 차별 금지 정책에<br> 동의하는 것입니다.
		</a>


		
			<div class="join-btn">회원가입</div>
	




<div class="modal-frame">
  <div class="modal-body">
    <div class="modal-inner">
      <button id="close" class="close"><i class="fa fa-times"></i></button>
      <p id='sucOrfailLetter'></p>
      브랜드명 :<input type="text" class='joinModalInput' id="insertBrname"><br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;로고 :<input type="text" class='joinModalInput' id="insertLogo">
      <button id="create-brand"><i class="fa fa-plus" aria-hidden="true"></i></button>
    </div>
  </div>
  <div class="modal-overlay"></div>
</div>




</body>


<script src="node_modules/jquery/dist/jquery.min.js"></script>
<script>
	
	
	
$modal = $('.modal-frame');

function enterNewConvo() {
  $('.create-chat-input').focus();
}

function closeModal() {
  	$modal.removeClass('active');
    $modal.addClass('leave');
}

$('#brnameSearch').click(function() {
  $modal.toggleClass('active');
  $modal.removeClass('leave');
  enterNewConvo();
})

$('.modal-overlay').click(function() {
  closeModal();
})

$('#close').click(function() {
  	closeModal();
})

  $(document).keyup(function(e) {
    if(e.which === 27) {
      closeModal();
    }
  })
  
  
  
  
  var fiBrname = $('#brname')
  var insertBrname= $('#insertBrname')
  var insertLogo = $('#insertLogo')
  var brname=0;
  var joinComno=0;
	   $('#brnameSearch').click(function(){
		  
		  brname = fiBrname.val()
		   $.getJSON('/brand/listByBrand2.json', {'brname': brname}, function(result) {
			   console.log(result)
			   var inputedBrname = result.data
			   
			   if(result.data=="success"){
				   $('#sucOrfailLetter').text("이미 등록되어있는 업체입니다. 다시 조회해 주세요.")
			   }else{
				   $('#sucOrfailLetter').text("등록되어있지 않은 업체입니다. 추가하시겠습니까?")
				   insertBrname.val(inputedBrname)
				   
				   
				   $('#create-brand').click(function() {				
						$.post('/brand/add.json', {
							'brname' : insertBrname.val(),
							'logo':insertLogo.val()
						}, function(result) {
						  if(result.status == 'success'){
							  
							 console.log(result)
							 joinComno=result.data
							 closeModal()
						  }
						 }, 'json')
						})
					   }
					  })	
			  		 })
	  
var fiEmail = $('#email'), 
		fiPwd = $('#pwd'), 
		fiType = $('.memberType'),
		fiBrname= $('#brname'),
		fiBusinessNumber= $('#businessNumber'),
		fiCeotel= $('#ceotel')
		fiAlias=$('#alias')
		
	var fiTypeNumber = 0;
	$(".sign-in-form2").css('display', 'none')
	var businessJoinSquare = false
	function doOpenCheck(b) {

		console.log(b.value);
		fiTypeNumber = b.value
		if (b.value == 2) {
			$('.form').animate({
				width : 750
			}, 700)
			$(".sign-in-form2").fadeIn(1200)
			businessJoinSquare = true
		} else {
			$('.form').animate({
				width : 350
			}, 700)
			$(".sign-in-form2").fadeOut(400)
			businessJoinSquare = false
		}
		for (var i = 0; i < fiType.length; i++) {
			if (fiType[i] != b) {
				fiType[i].checked = false;
			}
		}
	}

	 $('.join-btn').on('click', function() {
		console.log("회원타입",fiTypeNumber)
		if(fiTypeNumber==1){
			console.log("일반멤버포스트단계다.")
		$.post('/member/add.json', {
			'email' : fiEmail.val(),
			'pwd' : fiPwd.val(),
			'alias': fiAlias.val(),
			'type' : fiTypeNumber
		}, function(result) {
			console.log(result.status)
			location.href = 'home.html'
		}, 'json')
	}else if(fiTypeNumber==2){
		console.log("비지니스멤버포스트단계다.")
		$.post('/busimember/add.json', {
			'email' : fiEmail.val(),
			'pwd' : fiPwd.val(),
			'alias': fiAlias.val(),
			'type' : fiTypeNumber,
			'comno': joinComno,
			'busino':fiBusinessNumber.val(),
			'ceotel':fiCeotel.val()
		}, function(result) {
			location.href = 'home.html'
		}, 'json')
	}
	})   
</script>
</html>
