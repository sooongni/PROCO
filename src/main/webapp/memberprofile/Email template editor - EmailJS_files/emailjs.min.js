function AppController(e,t,a,r,n){main_scope=e,e.SERVICE_PROVIDERS=[{type:"personal",provider:"Gmail",display:"Gmail",icon:"gmail.png",xnote:"Both Gmail and Google Apps accounts are supported. The account must be identical to the one authorized in Google."},{type:"personal",provider:"AOL",display:"AOL",icon:"aol.png",note:"Send one email from your account before using EmailJS",fields:[{field_name:"User Email:",model:"email"},{field_name:"User Password:",model:"password",password:!0}]},{type:"personal",provider:"FastMail",display:"FastMail",icon:"fastmail.png",note:"Need to upgrade to enable SMTP",fields:[{field_name:"User Email:",model:"email"},{field_name:"User Password:",model:"password",password:!0}]},{type:"personal",provider:"iCloud",display:"iCloud",icon:"icloud.png",note:null,fields:[{field_name:"User Email:",model:"email"},{field_name:"User Password:",model:"password",password:!0}]},{type:"transactional",provider:"Mailgun",display:"Mailgun",icon:"mailgun.png",note:null,fields:[{field_name:"API Key:",model:"api_key"},{field_name:"Domain:",model:"domain"}]},{type:"transactional",provider:"Mailjet",display:"Mailjet",icon:"mailjet.png",note:null,fields:[{field_name:"API Key:",model:"api_key"},{field_name:"Secret Key:",model:"secret_key"}]},{type:"personal",provider:"Mail.ru",display:"Mail.ru",icon:"mailru.png",note:null,fields:[{field_name:"User Email:",model:"email"},{field_name:"User Password:",model:"password",password:!0}]},{type:"transactional",provider:"Mandrill",display:"Mandrill",icon:"mandrill.png",note:null,fields:[{field_name:"API Key:",model:"api_key"}]},{type:"personal",provider:"Hotmail",display:"Outlook",icon:"outlook.png",note:"Enable POP in settings->Connect devices and apps with POP",fields:[{field_name:"User Email:",model:"email"},{field_name:"User Password:",model:"password",password:!0}]},{type:"transactional",provider:"SendGrid",display:"SendGrid",icon:"sendgrid.png",note:'The API key can be obtained from Sendgrid dashboard. <a href="https://sendgrid.com/docs/User_Guide/Settings/api_keys.html#-Create-an-API-Key" target="_blank">Learn more</a>.',fields:[{field_name:"API KEY:",model:"api_key"},{field_name:"Unsubscribe group ID:",model:"asm_group_id",optional:!0,placeholder:"E.g. 1234 (Optional)"},{field_name:"Groups to display:",model:"asm_groups_to_display",optional:!0,placeholder:"E.g. 123,44,6934 (Optional)"}]},{type:"transactional",provider:"SES",display:"Amazon SES",icon:"ses.png",note:null,fields:[{field_name:"Access Key ID:",model:"access_key"},{field_name:"Secret Key:",model:"secret_key"},{field_name:"Region:",model:"region"}]},{type:"transactional",provider:"Postmark",display:"Postmark",icon:"postmark.png",note:null,fields:[{field_name:"Server API token:",model:"api_key"}]},{type:"personal",provider:"Yahoo",display:"Yahoo",icon:"yahoo.jpg",note:null,fields:[{field_name:"User Email:",model:"email"},{field_name:"User Password:",model:"password",password:!0}]},{type:"personal",provider:"Yandex",display:"Yandex",icon:"yandex.png",note:null,fields:[{field_name:"User Email:",model:"email"},{field_name:"User Password:",model:"password",password:!0}]},{type:"personal",provider:"Zoho",display:"Zoho",icon:"zohomail.png",note:null,fields:[{field_name:"User Email:",model:"email"},{field_name:"User Password:",model:"password",password:!0}]},{type:"personal",provider:"SMTP",display:"SMTP server",icon:"smtp.png"}],e.SERVICES_INFO={};for(var s=0;s<e.SERVICE_PROVIDERS.length;s++)e.SERVICES_INFO[e.SERVICE_PROVIDERS[s].provider]=e.SERVICE_PROVIDERS[s];e.TEMPLATE_DESIGNS=[{name:"Blank",template:"blank.html"},{name:"Mailgun Action",template:"mailgun_action.html"},{name:"Mailgun Alert",template:"mailgun_alert.html"},{name:"Mailgun Billing",template:"mailgun_billing.html"},{name:"Postmark Welcome",template:"postmark_welcome.html"},{name:"Cakemail",template:"cakemail.html"}],e.SES_REGIONS=[{value:null,name:"Default"},{value:"ap-northeast-1",name:"Asia Pacific (Tokyo)"},{value:"ap-southeast-1",name:"Asia Pacific (Singapore)"},{value:"ap-southeast-2",name:"Asia Pacific (Sydney)"},{value:"eu-central-1",name:"EU (Frankfurt)"},{value:"eu-west-1",name:"EU (Ireland)"},{value:"sa-east-1",name:"South America (Sao Paulo)"},{value:"us-east-1",name:"US East (N. Virginia)"},{value:"us-west-1",name:"US West (N. California)"},{value:"us-west-2",name:"US West (Oregon)"}],e.UPGRADE_LINK="/account/plans",e.DEFAULT_SERVICE_ID="default_service",e.tinymceOptions={menubar:!1,plugins:["lists link image code fullscreen media table textcolor colorpicker preview "],toolbar1:"bold italic underline strikethrough | fontselect fontsizeselect | forecolor backcolor | alignleft aligncenter alignright alignjustify",toolbar2:"bullist numlist blockquote outdent indent | link unlink | image | undo redo | code | preview fullscreen",content_css:"/static/css/tinymce.css"},e.local_work_mode=PRODUCTION_MODE,e.emailjs=emailjs,e.free_user="free"==Inffuse.user.plan(),e.default_template={to_email:"",attachments:[],static_attachments:[],subject:"[EmailJS example] New message from {{from_name}}",reply_to:"{{reply_to}}",content:'<div style="border: 1px solid #e5e5e5; padding: 15px 20px; max-width: 600px; margin: auto;">\n<p>Hello {{to_name}},<br /><br />You got a new message from {{from_name}}:</p>\n<p style="padding: 12px; border-left: 6px solid #eee; font-style: italic;">{{{message_html}}}</p>\n<p>&nbsp;<br />Best wishes,<br />EmailJS team</p>\n</div>',use_default_from_email:!0,captcha:!1,name:"Email Template Example",auto_reply:!1,auto_reply_params:{to_email:"",from_email:"",from_name:"",subject:"",content:""},add_contact:!1,add_contact_params:{email:"",name:"",address:"",phone:""}},e.init=function(){switch(hljs.configure({tabReplace:"   "}),e.local_work_mode){case"local":case"dev":e.emailjs.init(Inffuse.user.id(),document.location.host,!1);break;default:e.emailjs.init(Inffuse.user.id())}switch(e.data={},e.dataStore=Inffuse.user.getDataStore(),e.user_plan=Inffuse.user.plan(),e.max_templates=1e3,e.user_plan){case"free":e.max_templates=3;break;case"basic":e.max_templates=10}e.integration_code='<script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>\n<script type="text/javascript">\n	(function(){\n		emailjs.init("'+Inffuse.user.id()+'");\n	})();\n</script>\n',e.example_code='// parameters: service_id, template_id, template_parameters\nemailjs.send("<YOUR SERVICE ID>","<YOUR TEMPLATE ID>",{name: "James", notes: "Check this out!"});',e.promise_example_code='// parameters: service_id, template_id, template_parameters\nemailjs.send("<YOUR SERVICE ID>","<YOUR TEMPLATE ID>",{name: "James", notes: "Check this out!"})\n.then(function(response) {\n	console.log("SUCCESS. status=%d, text=%s", response.status, response.text);\n}, function(err) {\n	console.log("FAILED. error=", err);\n});',e.default_service_example_code='// parameters: service_id, template_id, template_parameters\nemailjs.send("default_service","<YOUR TEMPLATE ID>",{name: "James", notes: "Check this out!"});',e.captcha_code='<script src="https://www.google.com/recaptcha/api.js"></script>\n<div class="g-recaptcha" data-sitekey="6Lf3VxYTAAAAAOKOFvlfsXqkGdGmCumokPX3Yt6a"></div>',e.data.settings=e.dataStore.get("settings");var t=!1;if("undefined"==typeof e.data.settings?(e.data.settings={subsribe_to_weekly_report:!0},e.data.settings={subsribe_to_monthly_report:!0},t=!0):("undefined"==typeof e.data.settings.subsribe_to_weekly_report&&(e.data.settings.subsribe_to_weekly_report=!0,t=!0),"undefined"==typeof e.data.settings.subsribe_to_monthly_report&&(e.data.settings.subsribe_to_monthly_report=!0,t=!0)),t){var a=e.clean(e.data.settings);e.dataStore.set("settings",a),e.resetUser()}if(e.$watch("data.settings",function(t,a){if(t!==a){var r=e.clean(e.data.settings);e.dataStore.set("settings",r),e.resetUser()}},!0),e.data.services=e.dataStore.get("services",[]),e.$watch("data.services",function(t,a){if(t!==a){var r=e.clean(e.data.services);e.dataStore.set("services",r),e.resetUser()}},!0),e.data.templates=e.dataStore.get("templates"),"undefined"==typeof e.data.templates){e.default_template.system_id=e.generateID(10),e.default_template.id="template_"+e.generateID(8),e.default_template.to_email=Inffuse.user.email(),e.default_template.from_name=Inffuse.user.name(),e.default_template.use_default_from_email=!0,e.data.templates=[e.default_template];var r=e.clean(e.data.templates);e.dataStore.set("templates",r),e.resetUser()}e.quota=Inffuse.quotas.get(Inffuse.user.plan()),window.HW_config={selector:"#welcome",account:"RyEW27"},setTimeout(function(){$("head").append('<script async src="//cdn.headwayapp.co/widget.js"></script>')}),$("#header-menu").on("mousedown","#HW_badge_cont",function(){e.track("Notifications opened")}),window.onfocus=function(){e.$broadcast("focus")}},e.refreshQuota=function(){Inffuse.quotas.consume(Inffuse.user.plan(),0).done(function(t){e.quota=t.quota,e.$apply()}).fail(function(){e.quota=null,e.$apply()})},e.showError=function(t,a){e.openDialog("error",{title:t,message:a})},e.openDialog=function(t,a){e._dialog=t,e._formdata=e.clean(a),e.track("Dialog open ("+t+")",a)},e.closeDialog=function(t){e._formdata&&e._formdata.onClose&&e._formdata.onClose(),e._dialog=null,delete e._formdata},e.getDialogTemplate=function(){return"/static/html/dialogs/"+e._dialog+".html"},e.isSelectedView=function(e){return"/"==e?n.url()==e:0==n.url().indexOf(e)},e.clone=function(e){return JSON.parse(JSON.stringify(e))},e.generateUniqueId=function(){var e=1*new Date,t=""+e;return t},e.generateJavascriptId=function(e){return e.toLowerCase().replace(/\W+/g,"_")},e.capitalizeFirstLetter=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},e.generateID=function(e){for(var t="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",a="",r=0;e>r;r++)a+=t[Math.floor(Math.random()*t.length)];return a},e.isempty=function(e){if(!e)return!0;var t=Object.keys(e);return 0==t.length},e.safeParse=function(e){var t;try{t=JSON.parse(e)}catch(a){t=e}return t},e.clean=function(e){var t=Object.prototype.toString.call(e);switch(t){case"[object Object]":var a={};for(var r in e){var n=r.substr(0,1);"_"!=n&&"$"!=n&&(a[r]=this.clean(e[r]))}return a;case"[object Array]":var a=[];for(var r in e)a[r]=this.clean(e[r]);return a}return e},e.updateUser=function(){Inffuse.user.id()?(e.user={id:Inffuse.user.id(),accessToken:Inffuse.user.accessToken(),email:Inffuse.user.email(),name:Inffuse.user.name(),plan:Inffuse.user.plan()||"free"},mixpanel.identify(Inffuse.user.key()),mixpanel.name_tag(Inffuse.user.name()),mixpanel.people.set({$email:Inffuse.user.email(),$name:Inffuse.user.name()}),$zopim&&$zopim(function(){$zopim.livechat.setName(Inffuse.user.name()),$zopim.livechat.setEmail(Inffuse.user.email()),$zopim.livechat.addTags("Plan = "+Inffuse.user.plan()),$zopim.livechat.addTags("Inffuse ID = "+Inffuse.user.id()),$zopim.livechat.setNotes("http://dashboard.inffuse.com/app:emailjs/users/user:"+Inffuse.user.id())}),e.resetUser()):(e.user=null,mixpanel&&mixpanel.cookie&&mixpanel.cookie.clear())},e.logout=function(){Inffuse.user.logout().success(function(){e.updateUser(),e.$apply(),$next=n.path(),n.url("/account/login").search("next",$next)})},e.onContactUs=function(t,a){var r={subject:t,message:a};Inffuse.user.id()&&(r.email=Inffuse.user.email(),r.name=Inffuse.user.name()),e.openDialog("contact",r)},e.upgradePlan=function(t){e.closeDialog(),n.url(e.UPGRADE_LINK)},e.cancelPlan=function(){e.onContactUs("Cancel account","Please cancel my account")},e.contactUs=function(t){return Inffuse.services.zendesk.submit(t.name,t.email,{subject:t.subject,message:t.message}).success(function(){e.closeDialog(),e.$apply()}).error(function(){console.error("send support FAILED. error=",err),t.error=err.text,e.$apply()})},e.filter=function(e,t,a){n.search(e,t==a?null:t)},e.sort_by=function(e,t,a){var r=a?function(t){return a(t[e])}:function(t){return t[e]};return t=t?-1:1,function(e,a){return e=r(e),a=r(a),t*((e>a)-(a>e))}},e.resetUser=function(){var e="/api/v1.0/admin/reset";return new Promise(function(t,a){var r=new XMLHttpRequest;r.open("POST",e),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.onload=function(){200==this.status?t({status:r.status,text:r.responseText}):a({status:r.status,text:r.responseText})},r.onerror=function(){a({status:r.status,text:r.responseText})};var n={user_id:Inffuse.user.id()};r.send(JSON.stringify(n))})},e.getTemplateKeys=function(e){if(!e)return[];var t=e.match(/{{\s*[\w\.]+\s*}}/g);if(t){var a=t.map(function(e){return e.match(/[\w\.]+/)[0]});return a.filter(function(e){return"user_os"!=e&&"user_platform"!=e&&"user_browser"!=e&&"user_version"!=e})}return[]},e.updateUser()}function configRouterProvider(e){e.when("/home",{title:"Home",templateUrl:"/static/html/views/home.html",controller:"HomeCtrl",resolve:HomeCtrl.ready}).when("/",{title:"Email services",templateUrl:"/static/html/views/services.html",controller:"ServicesCtrl",resolve:ServicesCtrl.ready}).when("/templates",{title:"Email templates",templateUrl:"/static/html/views/email_templates.html",controller:"EmailTemplatesCtrl",resolve:EmailTemplatesCtrl.ready}).when("/templates/id::template_id",{title:"Email template editor",templateUrl:"/static/html/views/email_template.html",controller:"EmailTemplatesCtrl",resolve:EmailTemplatesCtrl.ready}).when("/integration",{title:"Integration",templateUrl:"/static/html/views/integration.html",controller:"AppController",resolve:AppController.ready}).when("/account",{title:"Account",templateUrl:"/static/html/views/account/account.html",controller:"UserCtrl",resolve:UserCtrl.ready}).when("/account/login",{title:"Login",templateUrl:"/static/html/views/account/login.html",controller:"UserCtrl",resolve:UserCtrl.ready}).when("/account/create",{title:"Create account",templateUrl:"/static/html/views/account/create_account.html",controller:"UserCtrl",resolve:UserCtrl.ready}).when("/account/forgot_password",{title:"Forgot password",templateUrl:"/static/html/views/account/forgot_password.html",controller:"UserCtrl",resolve:UserCtrl.ready}).when("/account/reset_password",{title:"Reset password",templateUrl:"/static/html/views/account/reset_password.html",controller:"UserCtrl",resolve:UserCtrl.ready}).when("/account/plans",{title:"Plans",templateUrl:"/static/html/views/account/plans.html",controller:"UserCtrl",resolve:UserCtrl.ready}).when("/history",{title:"Email History",templateUrl:"/static/html/views/email-history.html",controller:"EmailHistoryCtrl",resolve:EmailHistoryCtrl.ready}).when("/logs",{title:"Logs",templateUrl:"/static/html/views/logs.html",controller:"LogsCtrl",resolve:LogsCtrl.ready}).when("/statistics",{title:"Statistics",templateUrl:"/static/html/views/statistics.html",controller:"StatisticsCtrl",resolve:StatisticsCtrl.ready}).when("/contacts",{title:"Contacts",templateUrl:"/static/html/views/contacts.html",controller:"ContactsCtrl",resolve:ContactsCtrl.ready}).otherwise({title:"Page not found",templateUrl:"/static/html/views/404.html"})}function EmailTemplatesCtrl(e,t,a,r,n){function s(t){var a=e.data.templates.filter(function(e){return e.id==t});return 0==a.length?null:a[0]}e.CONTENT_TYPES=["application/atom+xml","application/dart","application/ecmascript","application/javascript","application/EDI-X12","application/EDIFACT","application/json","application/ecmascript","application/octet-stream","application/ogg","application/pdf","application/postscript","application/rdf+xml","application/rss+xml","application/soap+xml","application/font-woff","application/x-font-woff","application/xhtml+xml","application/xml","application/xml-dtd","application/xop+xml","application/zip","application/gzip","application/x-nacl","application/x-pnacl","audio/basic","audio/L24","audio/mp4","audio/mpeg","audio/ogg","audio/opus","audio/vorbis","audio/vnd.rn-realaudio","audio/vnd.wave","audio/webm","image/gif","image/jpeg","image/pjpeg","image/png","image/svg+xml","image/vnd.djvu","message/http","message/imdn+xml","message/partial","message/rfc822","model/iges","model/mesh","model/vrml","model/x3d+binary","model/x3d+fastinfoset","model/x3d+binary","model/x3d-vrml","model/x3d+vrml","model/x3d+xml","multipart/mixed","multipart/alternative","multipart/related","multipart/form-data","multipart/signed","multipart/encrypted","text/cmd","text/css","text/csv","text/html","text/javascript","text/plain","text/rtf","text/vcard","text/vnd.abc","text/xml","video/avi","video/mpeg","video/mp4","video/ogg","video/quicktime","video/webm","video/x-matroska","video/x-ms-wmv","video/x-flv"],e.$watch("email_template_form.$dirty",function(t){t?e.preventNavigation():e.allowNavigation()}),e.template,e.test_params_json={},e.findTemplateIndex=function(t){var a=-1;if("undefined"!=typeof t&&t)for(var r=0;r<e.data.templates.length;r++)if(e.data.templates[r].system_id==t){a=r;break}return a},e.cleanFormDirty=function(){},e.initTemplate=function(){var a=null,r=n.from_id;if(r?(a=e.clone(s(r)),delete a.system_id):a=s(n.template_id),a)a.attachments=a.attachments||[],a.static_attachments=a.static_attachments||[],e.template=e.clone(a),e.$apply(),$("#email-template").scope().email_template_form.$setPristine(),$("#email-template").scope().$apply();else if(n.design){var i=n.design;t.get("/static/html/designs/"+e.TEMPLATE_DESIGNS[i].template).success(function(t){e.template={content:t},e.template.attachments=[],e.template.static_attachments=[],e.template.use_default_from_email=!0}),$("#email-template").scope().email_template_form.$setPristine(),$("#email-template").scope().$apply()}},e.save_captcha_site_key=function(t){var a=e.findTemplateIndex(t.system_id);a>=0&&e.data.templates[a].captcha_site_key!==t.captcha_site_key&&(e.data.templates[a].captcha_site_key=t.captcha_site_key),e.template=e.clone(t)},e.onTestTemplate=function(t,a,r,n){return e.data.services.length<1?e.showError("No service found","Please add a service!"):(t.dirty=!1,"undefined"!=typeof a&&a&&(t.dirty=!0),"local"==r?e.openDialog("test_template",t):t.captcha?t.captcha_secret?e.openDialog("captcha_site_key",{template:t,jsfiddle_type:n}):e.showError("Captcha secret key missing","Please add your reCAPTCHA secret key"):e.test_jsfiddle(t,n)),!1},e.testTemplate=function(t){var a={};if(t.result=null,t.error=null,t.json_error=null,!t||!t.test_params||!t.test_params.service_id)return t.error="Please select a Service",e.$apply(),!1;if(t.test_params.json)try{a=JSON.parse(t.test_params.json)}catch(n){return t.json_error="Error parsing JSON: "+n,e.$apply(),!1}a.ejs_dashboard__test_template=!0;var s=t.test_params.service_id,i=t.id,o={service_id:s,json:t.test_params.json},l=e.findTemplateIndex(t.system_id);return l>=0&&(e.data.templates[l].test_params=o,e.template&&(e.template.test_params=o),e.$apply()),t.dirty?r(function(r,n){e.dataStore.set("template_draft",t).done(function(){e.resetUser(),e.emailjs.send(s,"__emailjs_template_draft__",a).then(function(a){t.result="OK",e.refreshQuota(),e.$apply(),e.track("Test template success",{"Template ID":i,"Service ID":s}),r()},function(a){console.error("send FAILED. error=",a),t.error=a.text,e.$apply(),e.track("Test template failure",{"Template ID":i,"Service ID":s,Error:a.text}),r()})}).fail(function(){t.error="Internal Error",e.$apply(),r()})}):e.emailjs.send(s,i,a).then(function(a){t.result="OK",e.refreshQuota(),e.$apply(),e.track("Test template success",{"Template ID":i,"Service ID":s})},function(a){console.error("send FAILED. error=",a),t.error=a.text,e.$apply(),e.track("Test template failure",{"Template ID":i,"Service ID":s,Error:a.text})})},e.OLD_testTemplate=function(t){var a={};if(t.result=null,t.error=null,t.json_error=null,!t||!t.test_params||!t.test_params.service_id)return t.error="Please select a Service",e.$apply(),!1;if(t.test_params.json)try{a=JSON.parse(t.test_params.json)}catch(n){return t.json_error="Error parsing JSON: "+n,e.$apply(),!1}a.ejs_dashboard__test_template=!0;var s=t.test_params.service_id,i=t.id,o={service_id:s,json:t.test_params.json},l=e.findTemplateIndex(t.system_id);return l>=0&&(e.data.templates[l].test_params=o,e.template&&(e.template.test_params=o),e.$apply()),t.dirty?r(function(r,n){e.dataStore.set("template_draft",t).done(function(){e.resetUser(),e.emailjs.send(s,"__emailjs_template_draft__",a).then(function(a){t.result="OK",e.refreshQuota(),e.$apply(),e.track("Test template success",{"Template ID":i,"Service ID":s}),r()},function(a){console.error("send FAILED. error=",a),t.error=a.text,e.$apply(),e.track("Test template failure",{"Template ID":i,"Service ID":s,Error:a.text}),r()})}).fail(function(){t.error="Internal Error",e.$apply(),r()})}):e.emailjs.send(s,i,a).then(function(a){t.result="OK",e.refreshQuota(),e.$apply(),e.track("Test template success",{"Template ID":i,"Service ID":s})},function(a){console.error("send FAILED. error=",a),t.error=a.text,e.$apply(),e.track("Test template failure",{"Template ID":i,"Service ID":s,Error:a.text})})},e.testTemplate=function(t){var a=t.test_params.service_id,n=t.id;return t.dirty?r(function(r,s){e.dataStore.set("template_draft",t).done(function(){e.resetUser(),e.emailjs.sendForm(a,"__emailjs_template_draft__","myform").then(function(s){t.result="OK",e.refreshQuota(),e.$apply(),e.track("Test template success",{"Template ID":n,"Service ID":a}),r()},function(s){console.error("send FAILED. error=",s),t.error=s.text,e.$apply(),e.track("Test template failure",{"Template ID":n,"Service ID":a,Error:s.text}),r()})}).fail(function(){t.error="Internal Error",e.$apply(),r()})}):e.emailjs.sendForm(a,n,"myform").then(function(r){t.result="OK",e.refreshQuota(),e.$apply(),e.track("Test template success",{"Template ID":n,"Service ID":a})},function(r){console.error("send FAILED. error=",r),t.error=r.text,e.$apply(),e.track("Test template failure",{"Template ID":n,"Service ID":a,Error:r.text})})},e.generate_test_template_keys=function(t){function a(e){for(var t=e.concat(),a=0;a<t.length;++a)for(var r=a+1;r<t.length;++r)t[a]===t[r]&&t.splice(r--,1);return t}e.test_params_json={},e.test_template_keys=[],e.test_template_has_inline_attachments=!1;var r=[],n=[];if(r=e.getTemplateKeys(t.to_email),r=r.concat(e.getTemplateKeys(t.from_name)),r=r.concat(e.getTemplateKeys(t.from_email)),r=r.concat(e.getTemplateKeys(t.reply_to)),r=r.concat(e.getTemplateKeys(t.cc)),r=r.concat(e.getTemplateKeys(t.bcc)),r=r.concat(e.getTemplateKeys(t.subject)),r=r.concat(e.getTemplateKeys(t.content)),t.attachments.length>0)for(var s=0;s<t.attachments.length;s++){var i=t.attachments[s];"upload"==i.type&&(n=n.concat(i.input_name)),"inline"==i.type&&(e.test_template_has_inline_attachments=!0,r=r.concat(e.getTemplateKeys(i.filename)),r=r.concat(e.getTemplateKeys(i.content)))}e.test_template_keys=a(r),e.test_template_upload_keys=n},e.test_jsfiddle=function(t,a){function r(e){for(var t=e.concat(),a=0;a<t.length;++a)for(var r=a+1;r<t.length;++r)t[a]===t[r]&&t.splice(r--,1);return t}var n=[];n=e.getTemplateKeys(t.to_email),n=n.concat(e.getTemplateKeys(t.from_name)),n=n.concat(e.getTemplateKeys(t.from_email)),n=n.concat(e.getTemplateKeys(t.reply_to)),n=n.concat(e.getTemplateKeys(t.cc)),n=n.concat(e.getTemplateKeys(t.bcc)),n=n.concat(e.getTemplateKeys(t.subject)),n=n.concat(e.getTemplateKeys(t.content));for(var s=t.attachments.filter(function(e){return"inline"===e.type})||[],i=0;i<s.length;i++)n=n.concat(e.getTemplateKeys(s[i].filename)),n=n.concat(e.getTemplateKeys(s[i].content));n=r(n);var o=[],l="'"+t.id+"'",c="'default_service'",p='<script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>',u='      emailjs.init("'+Inffuse.user.id()+'");',d=document.location.host;switch(e.local_work_mode){case"local":case"dev":p='<script type="text/javascript" src="http://'+d+'/dist/email.min.js"></script>',u='      emailjs.init("'+Inffuse.user.id()+'", "'+d+'", false);'}var m=[],f=[];switch(a){case"inline":if(t.attachments.length>0?o.push('<form id="myform" enctype="multipart/form-data" onsubmit="emailjs.sendForm('+c+", "+l+', this); return false;" method="post">'):o.push('<form id="myform" onsubmit="emailjs.sendForm('+c+", "+l+', this); return false;" method="post">'),n.length>0)for(var g,i=0;i<n.length;i++)g="<label>"+n[i]+"</label>",o.push(g),e.test_params_json[n[i]]?o.push('<input type="text" name="'+n[i]+'" value="'+e.test_params_json[n[i]]+'" />'):o.push('<input type="text" name="'+n[i]+'" />');else o.push("No dynamic variables in this template.<br>");if(t.attachments.length>0)for(var i=0;i<t.attachments.length;i++)"upload"==t.attachments[i].type&&(0==i?o.push("<lable>Attachments</lable>"):o.push("<lable>Attachments_"+i+"</lable>"),o.push('<input name="'+t.attachments[i].input_name+'" type="file" multiple/>'));s.length>0&&(o.push("<br><br><b>This template contains inline attachments.</b><br>"),o.push("Inline attachment content must be in <b>base64</b> encoding.<br>"),o.push('See <a href="https://www.emailjs.com/docs/user-guide/file-attachments/inline-content-example/" target="_blank">documentation</a> for canvas example.<br>')),t.captcha&&t.captcha_secret&&t.captcha_site_key&&(e.save_captcha_site_key(t),o.push(""),o.push('<script src="https://www.google.com/recaptcha/api.js"></script>'),o.push('<div class="g-recaptcha" data-sitekey="'+t.captcha_site_key+'"></div>'),o.push("")),o.push("<br><br>"),o.push("<button>"),o.push("Send"),o.push("</button>"),o.push("</form>"),o.push(""),o.push(p),o.push('<script type="text/javascript">'),o.push("   (function(){"),o.push(u),o.push("   })();"),o.push("</script>"),o.push(""),m=o.join("\r\n");break;case"send":if(o.push('<form id="myform">'),n.length>0)for(var g,i=0;i<n.length;i++)g="<label>"+n[i]+"</label>",o.push(g),e.test_params_json[n[i]]?o.push('<input type="text" name="'+n[i]+'" value="'+e.test_params_json[n[i]]+'" />'):o.push('<input type="text" name="'+n[i]+'" />');else o.push("No dynamic variables in this template.<br>");s.length>0&&(o.push("<br><br><b>This template contains inline attachments.</b><br>"),o.push("Inline attachment content must be in <b>base64</b> encoding.<br>"),o.push('See <a href="https://www.emailjs.com/docs/user-guide/file-attachments/inline-content-example/" target="_blank">documentation</a> for canvas example.<br>')),t.captcha&&t.captcha_secret&&t.captcha_site_key&&(e.save_captcha_site_key(t),o.push(""),o.push('<script src="https://www.google.com/recaptcha/api.js"></script>'),o.push('<div class="g-recaptcha" data-sitekey="'+t.captcha_site_key+'"></div>'),o.push("")),o.push("<br><br>"),o.push("<button>"),o.push("Send"),o.push("</button>"),o.push("</form>"),o.push(""),o.push('<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>'),o.push(""),o.push(p),o.push('<script type="text/javascript">'),o.push("   (function(){"),o.push(u),o.push("   })();"),o.push("</script>");var m=o.join("\r\n");f=['var myform = $("form#myform");',"myform.submit(function(event){","	event.preventDefault();","","	var params = myform.serializeArray().reduce(function(obj, item) {","     obj[item.name] = item.value;","     return obj;","  }, {});","","  // Change to your service ID, or keep using the default service",'  var service_id = "default_service";',"",'  var template_id = "'+t.id+'";','  myform.find("button").text("Sending...");',"  emailjs.send(service_id,template_id,params)","  	.then(function(){ ",'       alert("Sent!");','       myform.find("button").text("Send");',"     }, function(err) {",'       alert("Send email failed!\\r\\n Response:\\n " + JSON.stringify(err));','       myform.find("button").text("Send");',"    });","  return false;","});"].join("\r\n");break;case"sendForm":if(t.attachments.length>0?o.push('<form id="myform" enctype="multipart/form-data" method="post">'):o.push('<form id="myform" method="post">'),n.length>0)for(var g,i=0;i<n.length;i++)g="<label>"+n[i]+"</label>",o.push(g),e.test_params_json[n[i]]?o.push('<input type="text" name="'+n[i]+'" value="'+e.test_params_json[n[i]]+'" />'):o.push('<input type="text" name="'+n[i]+'" />');else o.push("No dynamic variables in this template.<br>");if(t.attachments.length>0)for(var i=0;i<t.attachments.length;i++)"upload"==t.attachments[i].type&&(0==i?o.push("<lable>Attachments</lable>"):o.push("<lable>Attachments_"+i+"</lable>"),o.push('<input name="'+t.attachments[i].input_name+'" type="file" multiple/>'));s.length>0&&(o.push("<br><br><b>This template contains inline attachments.</b><br>"),o.push("Inline attachment content must be in <b>base64</b> encoding.<br>"),o.push('See <a href="https://www.emailjs.com/docs/user-guide/file-attachments/inline-content-example/" target="_blank">documentation</a> for canvas example.<br>')),t.captcha&&t.captcha_secret&&t.captcha_site_key&&(e.save_captcha_site_key(t),o.push(""),o.push('<script src="https://www.google.com/recaptcha/api.js"></script>'),o.push('<div class="g-recaptcha" data-sitekey="'+t.captcha_site_key+'"></div>'),o.push("")),o.push("<br><br>"),o.push("<button>"),o.push("Send"),o.push("</button>"),o.push("</form>"),o.push(""),o.push('<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>'),o.push(""),o.push(p),o.push('<script type="text/javascript">'),o.push("   (function(){"),o.push(u),o.push("   })();"),o.push("</script>");var m=o.join("\r\n");f=["",'var myform = $("form#myform");',"myform.submit(function(event){","	event.preventDefault();","","  // Change to your service ID, or keep using the default service",'  var service_id = "default_service";','  var template_id = "'+t.id+'";',"",'  myform.find("button").text("Sending...");','  emailjs.sendForm(service_id,template_id,"myform")',"  	.then(function(){ ",'    	alert("Sent!");','       myform.find("button").text("Send");',"    }, function(err) {",'       alert("Send email failed!\\r\\n Response:\\n " + JSON.stringify(err));','       myform.find("button").text("Send");',"    });","  return false;","});"].join("\r\n")}var h=["body {","  font-family: arial;","  font-size: 12px;","  color: #666;","}","form {","  width: 500px;","  background: white;","  padding: 20px 25px;","  margin: auto;","  margin-top: 30px;","  box-shadow: 0px 1px 2px rgba(0,0,0,0.2);","}","form input,","form textarea {","  font: inherit;","  padding: 5px 5px;","  width: 100%;","  margin-top: 3px;","  margin-bottom: 15px;","  box-sizing: border-box;","}","form button {","  border: 1px solid rgba(0,0,0,0.2);","  padding: 8px 35px;","  font-size: 12px;","  background: #888;","  color: white;","}","form label {","  color: #777;","  font-size: 11px;","  margin-bottom: 2px;","  display: block;","}"],_=[];if("inline"==a)var _=["form:after {","  content: '';","  position: absolute;","  left: 3px;","  top: 3px;","  right: 3px;"," box-shadow: 0px 2px 3px rgba(0,0,0,0.2);","  text-shadow: 1px 1px white;","  font-size: 11px;"," padding: 18px;","  text-align: center;","  box-sizing: border-box;","  margin-top: -100px;","  transition: all .3s;","}","form.emailjs-success:after,","form.emailjs-sending:after,","form.emailjs-error:after {","  margin-top: 0;","  transition: all .3s;","}","form.emailjs-sending:after {","  content: 'Sending email...';","  background: #eee;","}","form.emailjs-success:after {","  content: 'Email sent!';","  background: #1B5E20;","  color: white;","  text-shadow: -1px -1px black;","}","form.emailjs-error:after {","  content: 'Error sending email';","  background: #B71C1C;","  color: white;","  text-shadow: -1px -1px black;","}"];h=h.concat(_).join("\r\n");var v={html:m,js:f,css:h,title:"Test template "+t.id,description:"Sample code for sending your template"};$("#html").val(v.html),$("#js").val(v.js),$("#css").val(v.css),$("#title").val(v.title),$("#description").val(v.description),$("#panel_html").val(0),$("#panel_js").val(0),$("#panel_css").val(0),$("#wrap").val("l"),$("#invisible_form").submit(),e.track("Open JSFiddle",{"Template ID":t.id,Captcha:t.captcha,Type:a})},e.deleteTemplate=function(t,a){e.dataStore.loadData("templates").then(function(t){e.data.templates=t.value;var r=e.findTemplateIndex(a.system_id);e.data.templates.splice(r,1),e.$apply();var n=e.clean(e.data.templates);e.dataStore.set("templates",n),
e.track("Template deleted",{id:a.id})}).fail(function(e){console.error("ERROR load templates:",e)})},e.onAddTemplate=function(t){e.data.templates.length>=e.max_templates?e.openDialog("upgrade",{message:"Please upgrade to add more templates.",type:"templates_count"}):e.openDialog("create_template")},e.createTemplate=function(t){e.closeDialog(),a.url(a.url()+"/id:new?design="+t)},e.duplicateTemplate=function(t){e.data.templates.length>=e.max_templates?e.openDialog("upgrade",{message:"Please upgrade to add more templates.",type:"templates_count"}):(e.closeDialog(),a.url(a.url()+"/id:new?from_id="+t)),e.track("Duplicate template",{"Template ID":t})},e.validateTemplateId=function(t){if("new"==t)return'"new" is a reserved id';var a=null,r=n.from_id;if(r||(r=n.template_id),"new"==r)s(t)&&(a=t+" is already used");else{var i=s(t);i&&i.system_id!==e.template.system_id&&(a=t+" is already used")}return a},e.saveTemplate=function(t,r){return e.dataStore.loadData("templates").then(function(n){e.data.templates=n.value;var i=e.validateTemplateId(t.id);i&&(r._idError=i),delete t.dirty;var o=e.findTemplateIndex(t.system_id);if(o>=0){var l=s(t.id);l&&l.system_id!==t.system_id&&(alert(l.id+" is already used"),e.template.id=e.data.templates[o].id,e.$apply());var c=!1;e.data.templates[o].id!=t.id&&(c=!0),e.data.templates[o]=e.clean(t),e.$apply();var p=e.clean(e.data.templates);e.dataStore.set("templates",p).then(function(){e.resetUser(),e.track("Template updated",{"Template ID":t.id}),c?(r.email_template_form.$setPristine(),a.url("/templates/id:"+t.id),e.$apply()):(r.email_template_form.$setPristine(),e.$apply())})}else{var l=e.clean(t);"new"==l.id&&alert('"new" is a reserved id'),s(l.id)&&(alert(l.id+" is a already used"),l.id=""),l.system_id=e.generateUniqueId(),e.data.templates.push(l),e.$apply();var p=e.clean(e.data.templates);e.dataStore.set("templates",p).then(function(){e.resetUser(),e.track("Template added",{"Template ID":l.id}),r.email_template_form.$setPristine(),a.url("/templates/id:"+l.id),e.$apply()})}}).fail(function(e){console.error("ERROR load templates:",e)}),!1},e.uploadStaticAttachment=function(a){var r=(parseInt(a.attributes.index.value),a.attributes.template.value),n=a.files[0];if(n){var s=({user_id:Inffuse.user.id(),accessToken:Inffuse.user.accessToken()},new FormData);s.append("file",n),s.append("template_id",r),s.append("user_id",Inffuse.user.id()),s.append("accessToken",Inffuse.user.accessToken()),e.attachment_loading=!0;var i="/api/v1.1/upload";t.post(i,s,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(t){e.template.static_attachments=e.template.static_attachments||[],e.attachment_loading=!1;for(var r=0,n=0;n<e.template.static_attachments.length;n++)r+=e.template.static_attachments[n].size;var s=t.size+r;return"basic"==e.user_plan&&s>512e3?void e.openDialog("upgrade",{message:"Max total attachments size for your plan is 500kb",type:"upgrade"}):"professional"==e.user_plan&&s>2048e3?void e.openDialog("upgrade",{message:"Max total attachments size for your plan is is 2mb",type:"upgrade"}):s>2048e4?void e.openDialog("upgrade",{message:"Max total attachments size is 20mb",type:"upgrade"}):(e.template.static_attachments.push(t),e.email_template_form.$dirty=!0,void(a.value=null))}).error(function(t){e.attachment_loading=!1,console.error("File upload returned error: ",t)})}},e.showUpgradeDialog=function(t,a){e.openDialog("upgrade",{message:t,type:a})},e.removeStaticAttachment=function(t,a){e.template.static_attachments.splice(a,1),t.$dirty=!0,e.track("Static Attachment deleted")},e.addAttachment=function(t){return"free"==e.user_plan?void e.openDialog("upgrade",{message:"Please upgrade to enable attachments.",type:"attachments"}):(e.template.attachments.push({type:"upload"}),t.$dirty=!0,void e.track("Attachment added"))},e.removeAttachment=function(t,a){e.template.attachments.splice(a,1),t.$dirty=!0,e.track("Attachment deleted")},e.isUploadAttachment=function(e){return e&&e.attachments?"object"==typeof e.attachments.filter(function(e){return"upload"===e.type})[0]:!1},angular.element(document).ready(function(){e.dataStore.loadData("templates").then(function(t){e.data.templates=t.value,e.$apply(),(n.from_id||n.template_id||n.design)&&e.initTemplate()}).fail(function(e){console.error("ERROR load templates:",e)})})}function ServicesCtrl(e,t,a,r){function n(t){var a=e.data.services.filter(function(e){return e.id==t});return 0==a.length?null:a[0]}e.init=function(){},e.addGmailService=function(t){Inffuse.services.google.connect("https://mail.google.com",function(a){var r=a.tokens.refresh_token,n=a.tokens.access_token;if("undefined"==typeof r||!r||"undefined"==typeof n||!n)return t.error="Error connecting to Gmail. Bad tokens.",!1;var s={id:t.id,name:t.name,email:t.email,provider:"Gmail",refresh_token:r,access_token:n,connected:!0};e.data.services.push(s),1==e.data.services.length&&(e.data.settings.default_service=s.id),e.closeDialog(),e.$apply()})},e.disconnectGmail=function(t){Inffuse.services.google.disconnect().always(function(){t.refresh_token=null,t.access_token=null,t.connected=!1,e.$apply()})},e.connectGmail=function(t){e.track("Gmail connect"),Inffuse.services.google.connect("https://mail.google.com,https://www.googleapis.com/auth/userinfo.email",function(a){var r=a.tokens.refresh_token,n=a.tokens.access_token;return"undefined"!=typeof r&&r&&"undefined"!=typeof n&&n?(t.refresh_token=r,t.access_token=n,t.access_token=n,t.email=a.user.email,t.connected=!0,e.$apply(),void e.track("Gmail connected",{email:t.email})):(console.error("Error connecting to Gmail. Bad tokens."),void e.track("Gmail connect failed"))})},e.onSelectDefaultService=function(){e.openDialog("default_service",{id:e.data.settings.default_service})},e.selectDefaultService=function(t){e.data.settings.default_service=t.id,e.closeDialog(),e.$apply(),e.track("Default service changed",{"Service ID":t.id})},e.onAddService=function(){e.openDialog("add_service")},e.addService=function(t){var a={service:{provider:t.provider},provider:t,add_button_text:"Add Service"};"SMTP"==t.provider?e.openDialog("smtp_service_details",a):e.openDialog("service_details",a)},e.onUpdateservice=function(t,a){var r={index:t,service:e.clean(a),provider:e.SERVICES_INFO[a.provider],add_button_text:"Update Service"};"SMTP"==r.provider.provider?e.openDialog("smtp_service_details",r):e.openDialog("service_details",r)},e.saveService=function(t){var a="undefined"==typeof t.index;if(t.error="",t.test_error="",t.service.id===e.DEFAULT_SERVICE_ID)return t.error='"'+t.service.id+'" is a reserved ID',!1;if(a&&n(t.service.id))return t.error="Service with this Service ID already exists",!1;var r={id:t.service.id,name:t.service.name,provider:t.service.provider||t.provider.provider,connected:t.service.connected};switch(r.provider){case"SMTP":r.host=t.service.host,r.port=t.service.port,r.secure=t.service.secure,r.email=t.service.email,r.password=t.service.password;break;case"Postmark":case"Mandrill":r.api_key=t.service.api_key;break;case"Mailgun":r.api_key=t.service.api_key,r.domain=t.service.domain;break;case"Mailjet":r.api_key=t.service.api_key,r.secret_key=t.service.secret_key;break;case"SES":r.access_key=t.service.access_key,r.secret_key=t.service.secret_key,r.region=t.service.region;break;case"SendGrid":if(r.api_key=t.service.api_key,r.asm_group_id=t.service.asm_group_id,r.asm_groups_to_display=t.service.asm_groups_to_display,r.header=[],"string"!=typeof t.service.asm_group_id||isNaN(parseInt(t.service.asm_group_id))||r.header.push({key:"asm_group_id",value:parseInt(t.service.asm_group_id)}),"string"==typeof t.service.asm_groups_to_display){for(var s=t.service.asm_groups_to_display.split(","),i=[],o=0;o<s.length;o++)isNaN(parseInt(s[o]))||i.push(parseInt(s[o]));r.header.push({key:"asm_groups_to_display",value:i})}break;case"Gmail":if(a&&!t.service.connected)return t.error="Please connect your Gmail account",!1;r.email=t.service.email,r.refresh_token=t.service.refresh_token,r.access_token=t.service.access_token,r.connected=t.service.connected;break;default:r.email=t.service.email,r.password=t.service.password}return t.sendTestMail?e.emailjs.send(r.id,"__ejs-test-mail-service2__",r).then(function(n){a?(e.data.services.push(r),1==e.data.services.length&&(e.data.settings.default_service=r.id),e.track("Service added",{Provider:r.provider,"Service ID":r.id})):(e.data.services[t.index].id==e.data.settings.default_service&&(e.data.settings.default_service=r.id),e.data.services[t.index]=r,e.track("Service updated",{Provider:r.provider,"Service ID":r.id})),e.closeDialog(),e.$apply()},function(a){console.error(a.status,a.text);var r=JSON.parse(a.text);t.test_error=r.service_error||"None",e.$apply()}):(a?(e.data.services.push(r),1==e.data.services.length&&(e.data.settings.default_service=r.id),e.track("Service added",{Provider:r.provider,"Service ID":r.id})):(e.data.services[t.index].id==e.data.settings.default_service&&(e.data.settings.default_service=r.id),e.data.services[t.index]=r,e.track("Service updated",{Provider:r.provider,"Service ID":r.id})),e.closeDialog(),e.$apply(),void 0)},e.deleteService=function(t){var a=e.data.services[t].id,r=!1;e.data.settings.default_service==a&&(r=!0),e.data.services.splice(t,1),e.data.services.length>=1?e.data.settings.default_service=e.data.services[0].id:e.data.settings.default_service=null,e.track("Service deleted",{"Service ID":a})},e.onTestEmail=function(t){return"Gmail"!=t.provider||t.connected?void e.openDialog("test_mail",t):e.showError("Test error","Gmail service is not connected.<br><br>Please connect the Gmail service first through the service settings dialog.")},e.testEmail=function(t){return t.result="",t.error="",e.emailjs.send(t.id,"__ejs-test-mail-service__",null).then(function(a){t.result="OK",e.$apply(),e.track("Test service success",{"Service ID":t.id})},function(a){console.error(a.status,a.text),t.error=a.text,e.$apply(),e.track("Test service failure",{"Service ID":t.id,Error:a.text})})}}function HomeCtrl(e,t,a,r,n){e.loadRecentLogs=function(){return e.loadLogs(3).then(function(t){e.loading=!1,e.log_history=t},function(){console.error(status,data),e.loading=!1,e.log_history=null})},e.init=function(){}}function UserCtrl(e,t,a,r,n,s){e.plans=[{id:"free",name:"Free",pricing:{monthly:{amount:0},yearly:{amount:0}},features:["200 monthly emails","3 email templates","30 day contacts history","EmailJS footer"]},{id:"basic",name:"Basic",pricing:{monthly:{amount:5,checkout_page:"https://sites.fastspring.com/emailjs/instant/eTQLnceE"},yearly:{amount:48,checkout_page:"https://sites.fastspring.com/emailjs/instant/4emqhCij"}},features:["1,000 monthly emails","10 email templates","Unlimited contacts","Attachments up to 500kb","Completely white label"]},{id:"professional",name:"Professional",highlight:!0,pricing:{monthly:{amount:15,checkout_page:"https://sites.fastspring.com/emailjs/instant/lR0hR4ib"},yearly:{amount:144,checkout_page:"https://sites.fastspring.com/emailjs/instant/lRYcVxgn"}},features:["5,000 monthly emails","Unlimited email templates","Unlimited contacts","Attachments up to 2mb","Completely white label","Priority email support"]},{id:"business",name:"Business",pricing:{monthly:{amount:50,checkout_page:"https://sites.fastspring.com/emailjs/instant/zoAON8ns"},yearly:{amount:480,checkout_page:"https://sites.fastspring.com/emailjs/instant/By2Emer1"}},features:["25,000 monthly emails","Unlimited email templates","Unlimited contacts","Attachments up to 20mb","Completely white label","Priority email support","Phone support"]},{id:"enterprise",name:"Enterprise",pricing:{monthly:{amount:200,checkout_page:"https://sites.fastspring.com/emailjs/instant/Ox7hAZdy"},yearly:{amount:1920,checkout_page:"https://sites.fastspring.com/emailjs/instant/7eCBPbuY"}},features:["200,000 monthly emails","Unlimited email templates","Unlimited contacts","Attachments up to 20mb","Completely white label","Priority email support","Phone support"]}],e.initPlans=function(){e.plans.forEach(function(e){Inffuse.user.plan()==e.id&&(e.action={type:"current"})})},e.login=function(t,n){return e.error=null,Inffuse.user.login(t,n).success(function(t){mixpanel&&mixpanel.identify(Inffuse.user.key()),e.track("User logged in"),s(function(){r.location=a.search().next||"/"},300)}).error(function(t){e.error=t.responseJSON.error,e.updateUser(),e.$apply(),e.track("User login error",{error:e.error})})},e.forgot_password=function(t){return e.error=null,Inffuse.user.resetPasswordRequest(t).done(function(t){e.forgot_success=!0,e.$apply()}).fail(function(t){e.error=t.responseJSON.error,e.$apply()}),!1},e.resetPassword=function(t,a){if(e.error=null,t!==a)return e.error="Password don't match",void e.$apply();var r=n.emailjs_user,s=n.token,i=t;return Inffuse.user.resetPassword(r,i,s).done(function(t){e.reset_success=!0,e.$apply()}).fail(function(t){e.error=t.responseJSON.error,e.$apply()}),!1},e.createAccount=function(t,n,i){return e.error=null,Inffuse.user.create(t,n,i).success(function(t){mixpanel&&mixpanel.identify(Inffuse.user.key()),e.track("User created"),s(function(){r.location=a.search().next||"/"},300)}).error(function(t){e.error=t.responseJSON.error,e.updateUser(),e.$apply(),e.track("User create error",{error:e.error})})},e.updateUserParameters=function(t,a){return e.error=null,Inffuse.user.update({name:t.name,email:t.email}).success(function(t){a.form.$setPristine(),e.updateUser(),e.$apply()}).error(function(t){"undefined"!=typeof t.responseJSON.error?e.error=t.responseJSON.error:e.error="Unhandled error while updating user parameters!",e.$apply()})},e.onUpdatePassword=function(){e.openDialog("update_user_psw")},e.updateUserPassword=function(t,a){return t.password!==t.password_repeat?(t.error="New password doesn't match the retyped password!",!1):Inffuse.user.update({password:t.password,current_password:t.current_password}).success(function(r){a.$setPristine();for(var n in t)delete t[n];e.updateUser(),e.$apply()}).error(function(a){"undefined"!=typeof a.responseJSON.error?t.error=a.responseJSON.error:t.error="Unhandled error while updating user password!",e.$apply()})},e.choosePlan=function(t,a){return e.free_user?(window.open(Inffuse.fastspring.renderUrl(t.pricing[a].checkout_page)),void e.track("Plan selected",{Plan:t.name,Period:a})):void(t.id?e.onContactUs("Switch account","Please switch my account to "+t.name):e.onContactUs("Cancel account","Please cancel my account"))}}function EmailHistoryCtrl(e,t,a,r,n){e.$watch("current_page",function(t,a){t!=a&&e.refresh()}),e.current_page=1,e.page_length=50,e.total_pages=0,e.total_rows=0,e.count_start=0,e.template_filters=[],e.service_filters=[],e.resend_service_filters=[],e.result_filters=["Success","All Errors","Quota Error","Service Error","System Error","User Error"],e.filter_template="",e.resend_service="",e.filter_service="",e.filter_last_service="",e.filter_result="",e.filter_only_errors=!1,e.filter_retries=0,e.resend_service_filter="",e.rows=[],e.results=["OK","Quota Error","Service Error","System Error","User Error"],e.loading=!1,e.$watch("selectAll",function(){angular.forEach(e.rows,function(t){t.selected=e.selectAll}),e.track("History Select All",{flag:e.selectAll})}),e.init=function(){e.reset_filters()},e.reset_filters=function(){e.template_filters=[];for(var t=0;t<e.data.templates.length;t++)e.template_filters.push({id:e.data.templates[t].id,name:e.data.templates[t].name});e.service_filters=[];for(var t=0;t<e.data.services.length;t++)e.service_filters.push({id:e.data.services[t].id,name:e.data.services[t].name});e.resend_service_filters=[];for(var t=0;t<e.data.services.length;t++)e.resend_service_filters.push({id:e.data.services[t].id,name:e.data.services[t].name})},e.refresh=function(){e.loading=!0;var a={user_id:Inffuse.user.id(),accessToken:Inffuse.user.accessToken(),page:e.current_page,count:e.page_length,no_log:!0};e.filter_template&&(a.template_id=e.filter_template),e.filter_service&&(a.service_id=e.filter_service),e.filter_last_service&&(a.last_service_id=e.filter_last_service),e.filter_retries>0&&(a.min_retry_count=e.filter_retries),e.result_filters.indexOf(e.filter_result)>-1&&(1==e.result_filters.indexOf(e.filter_result)?a.errors_only=!0:0==e.result_filters.indexOf(e.filter_result)?a.result=0:a.result=e.result_filters.indexOf(e.filter_result)-1);var r="/api/v1.1/history?"+$.param(a);return t.get(r).success(function(t,a,r,n){for(e.loading=!1,e.rows=t.rows,i=0;i<e.rows.length;i++)e.rows[i].template_params=e.safeParse(e.rows[i].template_params);e.total_rows=t.total_count,e.total_pages=Math.ceil(t.total_count/e.page_length),e.count_start=(e.current_page-1)*e.page_length,e.selectAll=!1}).error(function(t,a,r,n){e.loading=!1,e.selectAll=!1,console.error("list email history FAILED. status=%d, error=%s",a,t),e.rows=[],e.current_page=1,e.page_length=50,e.total_pages=0,e.total_rows=0,e.count_start=0})},e.selectedCount=function(){return e.rows.reduce(function(e,t){return e+(t.selected?1:0)},0)},e.del=function(t){var a,r=[];if(t)r.push(e.deleteEmail(t));else for(var n=0;n<e.rows.length;n++)e.rows[n].selected&&r.push(e.deleteEmail(e.rows[n].id));return a=Promise.all(r)["catch"](function(e){console.error("Error found. status: %d, error: %s",e.status,e.data.error)}),e.track("History Delete",{email_id:t}),e._deleteInProgress=!0,a.then(function(t,a,r,n){e.refresh().then(function(){e._deleteInProgress=!1})})},e.deleteEmail=function(e){var a=$.param({user_id:Inffuse.user.id(),accessToken:Inffuse.user.accessToken(),no_log:!0}),r="/api/v1.1/history/"+e+"?"+a;return t["delete"](r)},e.resend=function(t){e.openDialog("resend",{services:e.service_filters,callback:function(a){var r,n=[];if(t)n.push(e.resendEmail(t,a));else for(var s=0;s<e.rows.length;s++)e.rows[s].selected&&n.push(e.resendEmail(e.rows[s].id,a));return r=Promise.all(n)["catch"](function(e){console.error("Error found. status: %d, error: %s %s",e.status,e.data.error,e.data.service_error)}),e.track("History Resend",{email_id:t,service_id:String(a)}),new Promise(function(t,a){r.then(function(){e.refresh().then(function(){e.closeDialog(),e.refreshQuota(),t()})})})}})},e.resendEmail=function(e,a){var r={user_id:Inffuse.user.id(),accessToken:Inffuse.user.accessToken(),email_id:e};a&&(r.service_id=a);var n="/api/v1.1/email/resend";return t.post(n,r)},e.select=function(e,t){t.stopImmediatePropagation(),e.selected=!e.selected}}function LogsCtrl(e,t,a,r,n){e.$watch("current_page",function(t,a){t!=a&&e.refresh()}),e.current_page=1,e.page_length=50,e.total_pages=0,e.total_rows=0,e.count_start=0,e.rows=[],e.filter_email_id="",e.loading=!1,e.init=function(){e.refresh()},e.refresh=function(){return e.loading=!0,e.ListLogs().then(function(t){e.loading=!1;var a=JSON.parse(t.text);e.rows=a.logs,e.total_rows=a.total_count,e.total_pages=Math.ceil(a.total_count/e.page_length),e.count_start=(e.current_page-1)*e.page_length,e.$apply()},function(t){e.loading=!1,console.error("list Logs FAILED. error=",t),e.$apply()})},e.ListLogs=function(){var t={user_id:Inffuse.user.id(),accessToken:Inffuse.user.accessToken(),page:e.current_page,count:e.page_length,no_log:!0};e.filter_email_id&&(t.email_id=e.filter_email_id);var a="https:";"live"!=e.local_work_mode&&(a="http:");var r=[a,"",document.location.host,"api/v1.1/logs"].join("/");return r+="?"+$.param(t),new Promise(function(e,t){var a=new XMLHttpRequest;a.open("GET",r),a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.onload=function(){200==this.status?e({status:a.status,text:a.responseText}):t({status:a.status,text:a.responseText})},a.onerror=function(){t({status:a.status,text:a.responseText})},a.send()})}}function StatisticsCtrl(e,t,a,r,n){e.loading=!1,e.EmailSentLineChart=null,e.unit="day",e.init=function(){moment().isoWeekday(1),e.unit="day",e.updateEmailSentChartData("day")},e.updateEmailSentChartData=function(a){function r(e){var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return"?"+t.join("&")}var n={user_id:Inffuse.user.id(),accessToken:Inffuse.user.accessToken(),unit:a},s="/",i=[s,document.location.host,"api/v1.0/statistics"].join("/");return i+=r(n),t.get(i).success(function(t,r,n,s){var i={labels:[],datasets:[{label:"Emails Sent",fill:!0,backgroundColor:"rgba(151,187,205,0.2)",borderColor:"rgba(151,187,205,1)",pointBorderColor:"rgba(151,187,205,1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(151,187,205,1)",pointHoverBorderColor:"rgba(151,187,205,1)",pointHoverBorderWidth:2,tension:0,data:[]},{label:"Email Errors",fill:!0,backgroundColor:"rgba(180,0,0,0.2)",borderColor:"rgba(180,0,0,1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"rgba(180,0,0,1)",pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"rgba(180,0,0,1)",pointHoverBorderColor:"rgba(180,0,0,1)",pointHoverBorderWidth:2,tension:0,data:[]}]},o={type:"line",data:i,options:{animation:!1,events:["mousemove","mouseout","click","touchstart","touchmove","touchend"],xAxes:[{display:!0}],tooltips:{mode:"label"},scales:{xAxes:[{ticks:{maxRotation:0,autoSkip:!1,padding:250,callback:function(e,t){return t%4===0?e:""}}}]}}},l=[],c=moment();switch(a){case"day":l.push({date:c.format("YYYY-MM-DD"),sent:0,errors:0});for(var p=1;30>p;p++)l.push({date:c.subtract(p,"days").format("YYYY-MM-DD"),sent:0,errors:0});break;case"week":l.push({date:c.weekday(1).format("YYYY-MM-DD"),sent:0,errors:0});for(var p=1;20>p;p++)l.push({date:c.weekday(1).subtract(p,"weeks").format("YYYY-MM-DD"),sent:0,errors:0});break;case"month":l.push({date:c.format("YYYY-MM"),sent:0,errors:0});for(var p=0;12>p;p++)l.push({date:c.subtract(p,"months").format("YYYY-MM"),sent:0,errors:0})}for(var p=0;p<t.sent.length;p++)for(var u=0;u<l.length;u++)if(l[u].date==t.sent[p].date){l[u].sent=t.sent[p].total;break}for(var p=0;p<t.failed.length;p++)for(var u=0;u<l.length;u++)if(l[u].date==t.failed[p].date){l[u].errors=t.failed[p].total;break}for(l=l.sort(e.sort_by("date")),p=0;p<l.length;p++)i.labels[p]=l[p].date,i.datasets[0].data[p]=l[p].sent,i.datasets[1].data[p]=l[p].errors;var d=$("#chart-container canvas"),m=$('<canvas style="width: 100%; height: 400px;"></canvas>');d.replaceWith(m);var f=m[0].getContext("2d");e.EmailSentLineChart=new Chart(f,o)}).error(function(e,t,a,r){console.error("Query statistics error. status:%d, error:%s",t,e)})},e.randomColor=function(){for(var e="ABCDEF0123456789",t="#";t.length<7;)t+=e.charAt(Math.floor(16*Math.random()+1));return t},e.$on("focus",function(t,a){e.updateEmailSentChartData(e.unit)})}function ContactsCtrl(e,t,a,r,n){e.$watch("current_page",function(t,a){t!=a&&e.refresh()}),e.current_page=1,e.page_length=50,e.total_pages=0,e.total_contacts=0,e.count_start=0,e.filter_template="",e.template_filters=[],e.contacts=[],e.loading=!1,e.init=function(){e.reset_filters()},e.reset_filters=function(){e.template_filters=[];for(var t=0;t<e.data.templates.length;t++)e.template_filters.push({id:e.data.templates[t].id,name:e.data.templates[t].name})},e.refresh=function(){e.loading=!0;var a=$.param({user_id:Inffuse.user.id(),accessToken:Inffuse.user.accessToken(),template_id:e.filter_template||null,no_log:!0});e.exportURL="/api/v1.0/contacts/export?"+a;var r=$.param({user_id:Inffuse.user.id(),accessToken:Inffuse.user.accessToken(),template_id:e.filter_template||null,page:e.current_page,count:e.page_length,no_log:!0}),n="/api/v1.0/contacts/?"+r;return t.get(n).success(function(t,a,r,n){e.loading=!1,e.contacts=t.rows,e.total_contacts=t.total_count,e.total_pages=Math.ceil(t.total_count/e.page_length),e.count_start=(e.current_page-1)*e.page_length}).error(function(t,a,r,n){e.loading=!1,console.error("listContacts FAILED. error=",err),e.$apply()})},e.deleteContact=function(a){e.loading=!0;var r=$.param({user_id:Inffuse.user.id(),accessToken:Inffuse.user.accessToken(),no_log:!0}),n="/api/v1.0/contacts/"+a+"?"+r;return t["delete"](n).success(function(t,a,r,n){e.refresh(),e.loading=!1}).error(function(t,a,r,n){console.error("Delete contact error. status:%d, error:%s",a,t),e.loading=!1})}}var main_scope;angular.module("App",["ngRoute","textAngular","ui.tinymce","ngAnimate"]).controller("AppController",["$scope","$http","$timeout","$q","$location",AppController]).config(["$interpolateProvider",function(e){e.startSymbol("[["),e.endSymbol("]]")}]).config(["$routeProvider",configRouterProvider]).config(["$locationProvider",function(e){e.html5Mode({enabled:!0,requireBase:!1}).hashPrefix("!")}]).run(["$rootScope",function(e){e.track=function(e,t){t&&(t=angular.copy(t)),mixpanel.track(e,t)}}]).run(["$rootScope","$location",function(e,t){e.$on("$routeChangeStart",function(a,r,n){$path=t.path(),null==Inffuse.user.id()&&"/account/login"!=$path&&"/account/create"!=$path&&"/account/forgot_password"!=$path&&"/account/reset_password"!=$path&&"/contact"!=$path&&t.path("/account/login").search("next",$path),e.title=r.$$route.title,e.track(e.title+" view",{Page:$path})})}]).directive("asyncLoading",["$filter",function(){return{restrict:"A",priority:-1,link:function(e,t,a){function r(){var e=t.find(".async-loading-target");e.length||(e=t.find("button[type!=button]")),e.length||(e=t),t.addClass("loading"),e.addClass("async-loading-target"),e.append('<div class="spinner spinner-generated"></div>')}function n(){t.removeClass("loading"),t.find(".spinner-generated").remove()}var s,i;a.ngClick?(s="click",i="ngClick"):a.ngSubmit?(s="submit",i="ngSubmit"):a.ngInit&&(s="init",i="ngInit",setTimeout(function(){t.trigger("init")}));var o=e.$eval(a.asyncLoading||"{}");o.flag?e.$watch(o.flag,function(){var t=e.$eval(o.flag);t?r():n()}):t.on(s,function(s){s.preventDefault(),s.stopImmediatePropagation(),r();var o=a[i],l=e.$eval(o);l?(l["finally"]||l.always||l.then).apply(l,[function(){n()}]):l===!1&&(t.removeClass("loading"),t.find(".spinner").remove()),e.$apply()})}}}]).directive("confirm",["$filter",function(){return{priority:-1,scope:{ngClick:"&ngClick",ngSubmit:"&ngSubmit"},link:function(e,t,a){var r;a.ngClick?r="click":a.ngSubmit&&(r="submit"),t.on(r,function(t){if(t.preventDefault(),t.stopImmediatePropagation(),a.confirmEnable&&!$(this).scope().$eval(a.confirmEnable))return a.ngClick?e.ngClick.call():a.ngSubmit&&e.ngSubmit.call(),void $(this).scope().$apply();var r=e.$root.$on("_actionConfirmed",function(e){e.currentScope!==e.targetScope&&e.currentScope.$broadcast("_actionConfirmed")}),n=e.$on("_actionConfirmed",function(e){a.ngClick?e.currentScope.ngClick.call():a.ngSubmit&&e.currentScope.ngSubmit.call()});$(this).scope().openDialog("confirm",{title:a.confirm,onClose:function(){r(),n()}}),$(this).scope().$apply()})}}}]).directive("code",["$filter",function(){return{restrict:"E",priority:-1,link:function(e,t,a){setTimeout(function(){hljs.highlightBlock(t[0])})}}}]).directive("blockify",["$filter",function(){return{restrict:"A",priority:-1,link:function(e,t,a){function r(e){if(-1==["STYLE","IFRAME"].indexOf(e.tagName)){if(e.nodeType==Node.TEXT_NODE){var t=e.textContent,a=t;if(a=a.replace(/[^\s]/g,"▄"),a=a.replace(/(\S) (\S)/g,"$1&#8203;▄$2"),a=a.replace(/▄▄▄/g,"▄"),t==a)return;var n=document.createElement("div");return n.appendChild(e.cloneNode()),void(e.parentElement.innerHTML=e.parentElement.innerHTML.replace(n.innerHTML,'<span style="opacity:0.6; text-shadow: 0px 1px;">'+a+"</span>"))}for(var s=e.childNodes,i=0;i<s.length;i++)r(s[i])}}r(t[0])}}}]).directive("buttonDropdown",["$compile",function(e){return{link:function(e,t,a){$(t).find(".arrow").click(function(e){e.stopPropagation(),e.preventDefault(),$(t).toggleClass("open")}),$("body").click(function(){$(t).removeClass("open")})}}}]).directive("suggest",["$compile","$timeout",function(e,t){return{restrict:"EA",scope:{items:"=items",ngModel:"="},link:function(t,a,r){function n(){t.open=!1,t.$apply()}t.open=!1,t.index=null;var s=$(a).find("input"),i=$('<div ng:if="open && (items|filter:value).length" class="suggest-container"></div>'),o='<div class="suggest-item" ng:click="select(item)" ng:repeat="item in items | filter:value track by $index" ng:class="{selected: index==$index}">[[item]]</div>';i.append(o),i.css({"font-size":s.css("font-size"),color:s.css("color"),left:s.offset().left,border:s.css("border")});var l=e($(i))(t);$(a).append(l),s.on("focus keyup",function(e){t.value=s.val(),t.open=!0,t.$apply()}),s.on("keydown",function(e){function a(e){var t=$(".suggest-container"),a=t.find(".suggest-item:eq("+e+")"),r=t.scrollTop(),n=r+t.height(),s=a.offset().top-t.offset().top,i=s+a.height(),o=n>=i&&s>=r;o||(console.log("scrolling to ",s),t.scrollTop(s))}if(40==e.keyCode||38==e.keyCode){null===t.index?t.index=0:40==e.keyCode?t.index+=1:t.index-=1;var r=$(".suggest-container"),s=r.find(".suggest-item").length;t.index=Math.min(t.index,s-1),t.index=Math.max(t.index,0),a(t.index)}if(13==e.keyCode){e.stopPropagation(),e.preventDefault();var r=$(".suggest-container"),i=r.find(".suggest-item:eq("+t.index+")");t.ngModel=i.text(),t.$apply(),n()}}),$("body").click(n),$(a).click(function(e){e.stopPropagation()}),t.select=function(e){t.ngModel=e,n()}}}}]).directive("pageSelect",["$compile",function(e){return{scope:{page:"=ngModel",ngChange:"&",count:"="},restrict:"E",template:'<a ng:click="page=page-1" class="arrow fa fa-angle-left" ng:class="{disabled: page<=1}"></a><span class="current-page" ng:model="page">[[page]]/[[count]]</span><a ng:click="page=page+1" class="arrow fa fa-angle-right" ng:class="{disabled: page>=count}"></a>',link:function(e,t,a,r){e.$watch("page",function(){e.ngChange&&e.ngChange()})}}}]).filter("unsafe",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).run(["$templateCache","$http",function(e,t){for(var a=["add_service","confirm","contact","create_template","default_service","error","service_details","test_mail","test_template","update_user_psw","upgrade","template_help","smtp_service_details","resend"],r=0;r<a.length;r++)t.get("/static/html/dialogs/"+a[r]+".html",{cache:e})}]).run(["$rootScope","$location",function(e,t){var a=!1,r=null;e.allowNavigation=function(){a=!1},e.preventNavigation=function(){a=!0,r=t.absUrl()},e.$on("$locationChangeStart",function(n,s,i){return r!=i||null==r?void e.allowNavigation():(a&&!confirm("You have unsaved changes, do you want to continue?")?n.preventDefault():e.allowNavigation(),void(window.onbeforeunload=function(){return a&&t.absUrl()==r?"You have unsaved changes, do you want to continue?":void 0}))})}]);var InffuseSDK=new InffuseSDK_01("emailjs");InffuseSDK.server="//inffuse-platform.appspot.com",InffuseSDK.context_params={platform:"web"},InffuseSDK.init(function(e){window.Inffuse=e,angular.element(document).ready(function(){angular.bootstrap(document,["App"])})}),EmailTemplatesCtrl.ready={},angular.module("App").controller("EmailTemplatesCtrl",["$scope","$http","$location","$q","$routeParams",EmailTemplatesCtrl]),ServicesCtrl.ready={},angular.module("App").controller("ServicesCtrl",["$scope","$http","$location","$routeParams",ServicesCtrl]),HomeCtrl.ready={},angular.module("App").controller("HomeCtrl",["$scope","$http","$location","$window","$routeParams",HomeCtrl]),UserCtrl.ready={},angular.module("App").controller("UserCtrl",["$scope","$http","$location","$window","$routeParams","$timeout",UserCtrl]),EmailHistoryCtrl.ready={},angular.module("App").controller("EmailHistoryCtrl",["$scope","$http","$location","$window","$routeParams",EmailHistoryCtrl]),LogsCtrl.ready={},angular.module("App").controller("LogsCtrl",["$scope","$http","$location","$window","$routeParams",LogsCtrl]),StatisticsCtrl.ready={},angular.module("App").controller("StatisticsCtrl",["$scope","$http","$location","$window","$routeParams",StatisticsCtrl]),ContactsCtrl.ready={},angular.module("App").controller("ContactsCtrl",["$scope","$http","$location","$window","$routeParams",ContactsCtrl]);